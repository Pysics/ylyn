<!--pages/chat/chat.wxml-->
<view class="container">
  <scroll-view class="chatBody" scroll-top="{{toTop}}" scroll-y="true" style="height: {{chatBodyHeight}}px;" bindtap="inputFocus">
    <block wx:for="{{messages}}" wx:key="message_id">
      <view class="me messageBlock" wx:if="{{item.user_id === meInfo.user_id}}">
        <image src="{{meInfo.avatar}}" class="avatar"></image>
        <view class="message">
          <view wx:if="{{item.type === 'mult'}}" class="multMsg">
            <block wx:for="{{item.content}}" wx:key="type">
              <text wx:if="{{item.type ==='text'}}">{{item.content}}</text>
              <image wx:if="{{item.type === 'face'}}" src="/images/faces/{{item.src}}" class="faceImg"></image>
            </block>
          </view>
          <image wx:if="{{item.type === 'img'}}" src="{{item.content}}" bindtap="prevImg" data-src='{{item.content}}' class="imgMsg"></image>
          <view class="angle"></view>
        </view>
      </view>
      <view class="friend messageBlock" wx:if="{{item.user_id !== meInfo.user_id}}">
        <image src="{{friendInfo.avatar}}" class="avatar"></image>
        <view class="message">
          <view wx:if="{{item.type === 'mult'}}" class="multMsg">
            <block wx:for="{{item.content}}" wx:key="type">
              <text wx:if="{{item.type ==='text'}}">{{item.content}}</text>
              <image wx:if="{{item.type === 'face'}}" src="/images/faces/{{item.src}}" class="faceImg"></image>
            </block>
          </view>
          <image wx:if="{{item.type === 'img'}}" src="{{item.content}}" bindtap="prevImg" data-src='{{item.content}}' class="imgMsg"></image>
          <view class="angle"></view>
        </view>
      </view>
    </block>
  </scroll-view>


  <view class="chatBar" style="min-height: {{faceShow ? '184px' : 'auto'}}">
    <view class="topBar">
      <view class="userCard">
        <text class="fa fa-vcard-o"></text>
      </view>
      <view class="inputWrap">
        <textarea class="textarea" bindfocus="inputFocus" bindblur="inputBlur" value="{{inputValue}}" auto-height fixed="{{true}}" bindinput="inputHandle"/>
      </view>
      <view class="face" bindtap="toggleFace">
        <text class="fa fa-meh-o"></text>
      </view>
      <view class="pic">
        <view class="fa fa-picture-o" wx:if="{{!isFocus}}" bindtap="sendPic"></view>
        <view class="submit" wx:if="{{isFocus}}" bindtap="submit">
          <text>发送</text>
        </view>
      </view>
    </view>

  <view class="faceContent" hidden="{{!faceShow}}">
    <import src="/pages/common/face/face" />
    <template is="face" data="{{faces}}" />
  </view>

  </view>

</view>